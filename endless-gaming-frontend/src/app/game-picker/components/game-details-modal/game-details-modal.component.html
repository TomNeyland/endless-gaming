<div class="game-details-modal" (keydown)="onKeyDown($event)" tabindex="-1">
  
  <!-- Modal Header -->
  <div class="modal-header">
    <div class="header-content">
      <div class="game-cover">
        <img 
          [src]="game.coverUrl" 
          [alt]="game.name + ' cover'"
          class="cover-image"
          loading="eager">
      </div>
      
      <div class="header-info">
        <h1 class="game-title">{{ game.name }}</h1>
        
        <div class="game-meta">
          <div class="meta-row">
            <span class="price">{{ getFormattedPrice() }}</span>
            @if (getAgeBadgeText()) {
              <span class="age-badge">{{ getAgeBadgeText() }}</span>
            }
          </div>
          
          <div class="meta-row">
            <span class="developers">{{ getDevelopersText() }}</span>
          </div>
          
          @if (game.releaseDate) {
            <div class="meta-row">
              <span class="release-info">{{ getFormattedAge() }}</span>
            </div>
          }
          
          @if (getReviewPercentage() !== null) {
            <div class="meta-row">
              <span class="review-info">{{ getReviewText() }}</span>
            </div>
          }
        </div>
        
        <!-- Top Tags -->
        @if (getTopTags(6).length > 0) {
          <div class="quick-tags">
            @for (tagInfo of getTopTags(6); track tagInfo.tag) {
              <span class="tag-chip">{{ tagInfo.tag }}</span>
            }
          </div>
        }
        
        <!-- Action Buttons -->
        <div class="action-buttons">
          <button 
            mat-raised-button 
            color="primary"
            (click)="openSteamStore()"
            class="steam-button">
            <mat-icon>open_in_new</mat-icon>
            View on Steam
          </button>
          
          @if (game.website) {
            <button 
              mat-stroked-button
              (click)="openWebsite()"
              class="website-button">
              <mat-icon>language</mat-icon>
              Website
            </button>
          }
        </div>
      </div>
    </div>
    
    <!-- Close Button -->
    <button 
      mat-icon-button 
      (click)="close()"
      class="close-button"
      matTooltip="Close">
      <mat-icon>close</mat-icon>
    </button>
  </div>

  <!-- Visual-First Content -->
  <div class="modal-content">
    
    <!-- Quick Overview Section -->
    <div class="quick-overview">
      @if (game.shortDescription) {
        <div class="overview-description">
          {{ game.shortDescription }}
        </div>
      }
      
      <div class="overview-meta">
        <!-- Top Tags -->
        <div class="overview-tags">
          @for (tagData of getTopTags(4); track tagData.tag) {
            <span class="overview-tag">{{ tagData.tag }}</span>
          }
        </div>
        
        <!-- Rating Bar -->
        @if (game.reviewPos || game.reviewNeg) {
          <div class="overview-rating">
            <div class="rating-bar-container">
              <div class="rating-bar">
                <div class="rating-fill" [style.width]="getReviewPercentage() + '%'"></div>
              </div>
              <span class="rating-text">{{ getReviewPercentage() }}% positive ({{ getTotalReviews() | number }} reviews)</span>
            </div>
          </div>
        }
      </div>
    </div>
    
    <!-- Media Gallery Section -->
    @if (hasMedia()) {
      <div class="media-section">
        <app-media-gallery
          [screenshots]="game.screenshots || []"
          [videos]="game.movies || []"
          (galleryEvent)="onGalleryEvent($event)">
        </app-media-gallery>
      </div>
    }
    
    <!-- Collapsible Content Sections -->
    <div class="content-sections">
      
      <!-- About This Game Section -->
      @if (game.detailedDescription) {
        <app-collapsible-section
          title="About This Game"
          icon="description"
          [isExpanded]="true">
          <div [innerHTML]="sanitizeHtml(game.detailedDescription)"></div>
        </app-collapsible-section>
      }
      
      <!-- System Requirements Section -->
      @if (hasSystemRequirements()) {
        <app-collapsible-section
          title="System Requirements"
          icon="settings"
          [isExpanded]="false">
          <div class="requirements-grid">
            @if (game.pcRequirements?.minimum) {
              <div class="requirement-block">
                <h4>Minimum</h4>
                <div class="requirement-content" [innerHTML]="getMinimumRequirements()">
                </div>
              </div>
            }
            
            @if (game.pcRequirements?.recommended) {
              <div class="requirement-block">
                <h4>Recommended</h4>
                <div class="requirement-content" [innerHTML]="getRecommendedRequirements()">
                </div>
              </div>
            }
          </div>
        </app-collapsible-section>
      }
      
      <!-- Details & Stats Section -->
      <app-collapsible-section
        title="Details & Stats"
        icon="info"
        [isExpanded]="false">
        <div class="details-grid">
          @if (getDevelopersText() !== 'Unknown') {
            <div class="detail-item">
              <label>Developer:</label>
              <span>{{ getDevelopersText() }}</span>
            </div>
          }
          
          @if (getPublishersText() !== 'Unknown') {
            <div class="detail-item">
              <label>Publisher:</label>
              <span>{{ getPublishersText() }}</span>
            </div>
          }
          
          @if (game.releaseDate) {
            <div class="detail-item">
              <label>Release Date:</label>
              <span>{{ game.releaseDate }}</span>
            </div>
          }
          
          @if (getStoreGenres().length > 0) {
            <div class="detail-item">
              <label>Genres:</label>
              <span>{{ getStoreGenres().join(', ') }}</span>
            </div>
          }
          
          @if (getCategories().length > 0) {
            <div class="detail-item">
              <label>Features:</label>
              <span>{{ getCategories().join(', ') }}</span>
            </div>
          }
          
          @if (game.requiredAge) {
            <div class="detail-item">
              <label>Age Rating:</label>
              <span>{{ game.requiredAge }}+</span>
            </div>
          }
        </div>
      </app-collapsible-section>
      
      <!-- Tags & Features Section -->
      @if (getTopTags().length > 0) {
        <app-collapsible-section
          title="Tags & Features"
          icon="local_offer"
          [isExpanded]="false">
          <div class="tags-container">
            @for (tagData of getTopTags(); track tagData.tag) {
              <div class="tag-item">
                <span class="tag-name">{{ tagData.tag }}</span>
                <span class="tag-votes">{{ tagData.votes | number }}</span>
              </div>
            }
          </div>
        </app-collapsible-section>
      }
      
    </div>
    
  </div>
  
</div>