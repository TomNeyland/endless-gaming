<mat-sidenav-container class="voting-drawer-container">
  <!-- Main content (pass-through) -->
  <mat-sidenav-content>
    <ng-content></ng-content>
  </mat-sidenav-content>

  <!-- Voting Drawer -->
  <mat-sidenav 
    #drawer 
    mode="side" 
    position="end" 
    [opened]="isOpen"
    (closedStart)="onDrawerClose()"
    class="voting-drawer">
    
    <!-- Drawer Header -->
    <mat-toolbar class="drawer-header">
      <span class="header-title">
        <mat-icon>tune</mat-icon>
        Refine Preferences
      </span>
      <button 
        mat-icon-button 
        (click)="drawer.close()"
        class="close-button">
        <mat-icon>close</mat-icon>
      </button>
    </mat-toolbar>

    <!-- Drawer Content -->
    <div class="drawer-content">
      @if (hasValidPair()) {
        <!-- Progress Info -->
        <div class="progress-section">
          <p class="mat-body-2 progress-text">{{ getVotingProgress() }}</p>
          <p class="mat-caption help-text">Choose your preferred game or skip if unsure</p>
        </div>

        <!-- Game Comparison - Vertical Stack -->
        <div class="comparison-section">
          <!-- Game Option 1 -->
          <div class="game-option">
            <mat-card class="game-card" appearance="outlined">
              <div class="game-image-container">
                <img 
                  [src]="getGameThumbnail(getLeftGame()!)"
                  [alt]="getLeftGame()!.name"
                  class="game-image"
                  (error)="$event.target.src='https://via.placeholder.com/300x169/667eea/ffffff?text=Game'">
              </div>
              
              <mat-card-content>
                <h3 class="game-title">{{ getLeftGame()!.name }}</h3>
                <p class="game-description">{{ getGameDescription(getLeftGame()!) }}</p>
              </mat-card-content>
            </mat-card>
            
            <button 
              mat-raised-button 
              color="primary"
              class="vote-button vote-left-btn"
              [disabled]="isVoting()"
              (click)="voteLeft()">
              <mat-icon>thumb_up</mat-icon>
              I Prefer This
            </button>
          </div>

          <!-- VS Divider -->
          <div class="vs-divider">
            <div class="vs-badge">
              <span class="vs-text">VS</span>
            </div>
            <div class="divider-line"></div>
          </div>

          <!-- Game Option 2 -->
          <div class="game-option">
            <mat-card class="game-card" appearance="outlined">
              <div class="game-image-container">
                <img 
                  [src]="getGameThumbnail(getRightGame()!)"
                  [alt]="getRightGame()!.name"
                  class="game-image"
                  (error)="$event.target.src='https://via.placeholder.com/300x169/667eea/ffffff?text=Game'">
              </div>
              
              <mat-card-content>
                <h3 class="game-title">{{ getRightGame()!.name }}</h3>
                <p class="game-description">{{ getGameDescription(getRightGame()!) }}</p>
              </mat-card-content>
            </mat-card>
            
            <button 
              mat-raised-button 
              color="primary"
              class="vote-button vote-right-btn"
              [disabled]="isVoting()"
              (click)="voteRight()">
              <mat-icon>thumb_up</mat-icon>
              I Prefer This
            </button>
          </div>
        </div>

        <!-- Skip Option -->
        <div class="skip-section">
          <button 
            mat-stroked-button 
            class="skip-button vote-skip-btn"
            [disabled]="isVoting()"
            (click)="skip()">
            <mat-icon>skip_next</mat-icon>
            Skip This Comparison
          </button>
        </div>

        <!-- Loading State -->
        @if (isVoting()) {
          <div class="voting-overlay">
            <div class="loading-content">
              <mat-spinner diameter="32"></mat-spinner>
              <p class="mat-body-2">Processing your choice...</p>
            </div>
          </div>
        }

      } @else {
        <!-- No More Pairs State -->
        <div class="no-pairs-section">
          <div class="no-pairs-content">
            <mat-icon class="success-icon">check_circle</mat-icon>
            <h3 class="mat-headline-6">Great Progress!</h3>
            <p class="mat-body-1">Your preferences have been updated. Keep the drawer open to see recommendations change as you continue voting, or close it when you're satisfied.</p>
            
            <button 
              mat-button 
              color="primary"
              (click)="drawer.close()"
              class="done-button">
              <mat-icon>check</mat-icon>
              Done for Now
            </button>
          </div>
        </div>
      }
    </div>
  </mat-sidenav>
</mat-sidenav-container>